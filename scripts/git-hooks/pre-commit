#!/bin/bash

# Pre-commit Hook: Run tests before commit
# This script ensures all tests pass before allowing a commit

echo "ğŸ§ª Running backend tests before commit..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

cd backend || exit 1

# Run tests with coverage report
./gradlew test jacocoTestReport --no-daemon --quiet

TEST_RESULT=$?

if [ $TEST_RESULT -ne 0 ]; then
    echo ""
    echo "âŒ Test Failed! Commit aborted."
    echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
    echo ""
    echo "ğŸ“‹ Fix the failing tests and try again:"
    echo "   ./gradlew test jacocoTestReport --no-daemon"
    echo ""
    exit 1
fi

echo ""
echo "âœ… All tests passed!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
exit 0
